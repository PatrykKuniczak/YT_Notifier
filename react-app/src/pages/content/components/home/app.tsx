import { i18n, useTranslation } from '@internationalization';
import { Portal } from '@mui/base';
import { ThemeProvider } from '@mui/system';
import GlobalStyles from '@utils/data/global-styles';
import theme from '@utils/data/themes/dark-theme';
import React, { useState } from 'react';
import { toast, ToastContainer } from 'react-toastify';
import { injectStyle } from 'react-toastify/dist/inject-style';

injectStyle();

function App() {
  const [loadedVideosAmount, setLoadedVideosAmount] = useState(0);
  const { t } = useTranslation();

  chrome.runtime.onMessage.addListener(({ loadedVideos, lang }) => {
    if (loadedVideos) {
      i18n.changeLanguage(lang);
      setLoadedVideosAmount(loadedVideos);
      toast(
        <div style={{ display: 'flex' }}>
          <div style={{ alignSelf: 'center' }}>
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 128 128" fill="none">
              <path
                d="M4.61047e-07 64C-6.4555e-07 76.658 3.75353 89.0317 10.7859 99.5565C17.8183 110.081 27.8138 118.284 39.5082 123.128C51.2027 127.972 64.071 129.24 76.4858 126.77C88.9005 124.301 100.304 118.205 109.255 109.255C118.205 100.304 124.301 88.9005 126.77 76.4858C129.24 64.071 127.972 51.2027 123.128 39.5083C118.284 27.8138 110.081 17.8184 99.5565 10.7859C89.0317 3.75353 76.658 9.55652e-07 64 0V25.6C71.5948 25.6 79.019 27.8521 85.3339 32.0716C91.6487 36.291 96.5705 42.2883 99.4769 49.3049C102.383 56.3216 103.144 64.0426 101.662 71.4915C100.18 78.9403 96.5232 85.7825 91.1529 91.1529C85.7825 96.5232 78.9403 100.18 71.4914 101.662C64.0426 103.144 56.3216 102.383 49.3049 99.4769C42.2883 96.5705 36.291 91.6487 32.0716 85.3339C27.8521 79.019 25.6 71.5948 25.6 64H4.61047e-07Z"
                fill="#7846F0"
              />
              <path
                d="M99.7459 88.7084L102.617 68.2825C105.143 50.2914 94.8749 33.4962 78.7634 26.9782C79.6755 25.664 80.3368 24.1512 80.5742 22.4618C81.3859 16.6863 77.3479 11.3276 71.5724 10.5159C65.7969 9.70422 60.4382 13.7423 59.6265 19.5177C59.3891 21.2074 59.6078 22.8434 60.1223 24.3583C42.8384 26.183 28.3385 39.4972 25.8081 57.4877L22.9375 77.9137C18.6758 78.7863 15.2149 82.2091 14.5732 86.7642C13.7622 92.5502 17.7896 97.8944 23.5751 98.7096L41.3827 101.212C41.8808 109.408 48.0786 116.393 56.5253 117.582C64.972 118.767 72.8552 113.761 75.5932 106.02L93.4008 108.523C99.1869 109.334 104.531 105.307 105.347 99.5216C105.985 94.966 103.602 90.7219 99.7459 88.7084ZM70.5911 17.4984C72.5141 17.7687 73.862 19.5574 73.5917 21.4804C73.3215 23.4034 71.5327 24.7514 69.6097 24.4811C67.6867 24.2108 66.3388 22.4221 66.609 20.4991C66.8793 18.5761 68.6683 17.2282 70.5911 17.4984ZM57.5066 110.599C52.9553 109.951 49.5359 106.494 48.6601 102.235L68.3161 104.998C66.3001 108.85 62.0601 111.231 57.5066 110.599Z"
                fill="#1F0E47"
              />
              <path
                d="M0 55.5789C1.41093e-06 40.8385 5.85562 26.7018 16.2787 16.2787C26.7018 5.85562 40.8385 1.62992e-07 55.5789 4.61047e-07V11.1158C43.7866 11.1158 32.4772 15.8003 24.1387 24.1387C15.8003 32.4772 11.1158 43.7866 11.1158 55.5789H0Z"
                fill="#1F0E47"
              />
              <path
                d="M83.3262 65.86L54.9276 43.675C53.5742 42.6185 51.667 42.3528 50.0805 42.9938C48.4626 43.6454 47.3057 45.1248 47.0627 46.8541L42.0474 82.5392C41.8043 84.2692 42.5079 86.0102 43.8757 87.0766C44.5514 87.6087 45.3607 87.9532 46.2157 88.0733C47.0683 88.1932 47.9403 88.0857 48.733 87.7632L82.1467 74.2638C83.7633 73.6097 84.9179 72.1307 85.1606 70.4038C85.4022 68.6791 84.7008 66.9392 83.3262 65.86ZM80.3919 69.9265L46.9758 83.4264C46.9074 83.4538 46.8312 83.447 46.7609 83.3922C46.7014 83.3452 46.6705 83.2677 46.6814 83.1904L51.6967 47.5046C51.7076 47.4273 51.7577 47.3619 51.8312 47.3321C51.8663 47.3173 51.9048 47.3125 51.9427 47.3178C51.9821 47.3234 52.0177 47.3386 52.0482 47.3626L80.4417 69.5445C80.5048 69.5943 80.5377 69.6737 80.5266 69.7525C80.5147 69.8319 80.4646 69.8966 80.3919 69.9265Z"
                fill="white"
              />
            </svg>
          </div>
          <p style={{ padding: '15px' }}>{t('videosLoaded', { loadedVideosAmount })}</p>
        </div>,
        {
          icon: false,
          toastId: 'notification',
        },
      );
    }
  });

  return (
    <ThemeProvider theme={theme}>
      <GlobalStyles />
      <Portal>
        <ToastContainer position="bottom-right" theme="dark" autoClose={false} />
      </Portal>
    </ThemeProvider>
  );
}

export default App;
